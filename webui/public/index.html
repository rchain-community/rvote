<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RV2020 Alpha - RChain Community Governance</title>
  <style>
    .privateKeyQR { display: hidden }  /* issue: fail safe if no CSS? */
    .attachment-full { float: right }
    #devKeyViz { float: right }
  </style>
  <link rel="stylesheet"
        href="https://cdn.rawgit.com/Chalarangelo/mini.css/v3.0.1/dist/mini-default.min.css">
</head>
<body>
  <a href="https://github.com/rchain-community/rv2020">
    <img width="149" height="149"
         src="https://github.blog/wp-content/uploads/2008/12/forkme_right_green_007200.png?resize=149%2C149"
         class="attachment-full size-full" alt="Fork me on GitHub"
         data-recalc-dims="1">
  </a>

  <label for="drawer-control" class="drawer-toggle persistent"></label>
  <input  type="checkbox" id="drawer-control" class="drawer persistent" />
  <nav>
    <label for="drawer-control" class="drawer-close"></label>
    <ul>
      <a href="#card-dev-acct">Account</a>
      <a href="#card-deploy-test">Testing</a>
      <a href="#card-intro">Intro</a>
      <a href="#card-contact">Contact</a>
    </ul>
  </nav>

  <h1>RV2020: An exploration into RChain governance</h1>

  <div class="card fluid" id="card-dev-acct">
  <h2 class="content-subhead">Device REV Account</h2>
  <p>
    <strong>Welcome!</strong> To participate in rv2020, this app
    maintains an account <strong>on this device</strong> to hold
    a small amount of REV for contract execution.
  </p>
  <form id="deviceKeyForm">
    <fieldset>
      <legend>Device Account</legend>
      <div id="devKeyViz"></div>

      <div>
        <label for="devAddr">Device REV address</label>
        <input id="devAddr" readonly="readonly" size="50" />
      </div>

      <div>
        <label for="devBal">Balance (<small>in revlettes: 10<sup>-8</sup> REV</small>)</label>
        <input id="devBal" readonly="readonly" placeholder='?' />
        <button id="checkBalance" type="button">re-check</button>
      </div>
      <button type="button"
              id="devKeyGen">Create Device REV Account</button>

      <p>
        <small><strong>Note:</strong> the private key is stored in
          <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"
             >localStorage</a> for this web site. To see it, enter
          <code>localStorage.getItem('deviceKey')</code> in a javascript console.
        </small>
      </p>
      <img id="qr3" class="privateKeyQR" />
    </fieldset>
  </form>
  <script type="module">
    import {
      observerUI, acctUI, walletUI, validatorUI, createAgendaUI,
      introUI,
    } from './_dist_/intro.js';
    const docAccess = {
      getElementById: (id) => document.getElementById(id),
      inputElement: (id) => document.getElementById(id),
    };
    const randomAccess = {
      getRandomValues: (arr) => window.crypto.getRandomValues(arr),
    };
    const observer = observerUI({ ...docAccess, fetch });
    const wallet = walletUI({ ...docAccess, ...randomAccess, localStorage });
    acctUI(wallet.getAddrInfo(), observer, docAccess)
    const clock = () => new Date();
    const validator = validatorUI(wallet.getKeyHex(), { ...docAccess, fetch, clock });

    createAgendaUI(validator.deploy, { ...docAccess });

    introUI(docAccess);
  </script>
  </script>
  </div>

  <div class="card fluid" id="card-create-agenda">
    <h2>Create Meeting Agenda</h2>
    <form id="agenda1">
      <fieldset>
        <legend>Create Agenda</legend>
        <div>
          <label for="meeting-title">Meeting Title</label>
          <input id="meeting-title" />
        </div>
        <div>
          <!--TODO:
          <label for="preamble">Preamble</label>
          <div contenteditable="true" id="preamble">
            <em>edit preamble to questions here...</em>
          </div>
          -->
        </div>
        <div>
          <label for="questions">Questions and Answers</label>
          <p><em><strong>Instructions:</strong> copy and paste from
              a spreadsheet with each question in column A
              followed by its answers in column B.
            </em>
          </p>
          <pre id="agenda-data" style="float: right"></pre>
          <textarea id="questions" rows="12" cols="40"></textarea>
        </div>
        <div>
          <label for="agenda-contract-uri">Agenda Contract URI</label>
          <input id="agenda-contract-uri" size="50"
                 value="rho:id:4eb8r4fybxsjsk5ystoc6mgdkf58jaxc85xup8n8zz6sn9utjz14wj"
                 />
          <br />
          <small><em><strong>TODO:</strong> register automatically
              and keep in <code>localStorage</code></em></small>
        </div>
        <button type="button" id="create-agenda">Create Agenda</button>
      </fieldset>
    </form>
  </div>

  <div class="card fluid" id="card-deploy-test">
    <h2>Deploy Integration Test</h2>
    <form id="deploy1">
        <fieldset>
            <label>
              Observer
              <select id="observerApiBase">
                <option value="https://observer.testnet.rchain.coop">testnet observer</option>
              </select>
            </label>
            <label>
              Validator
              <select id="validatorApiBase">
                <option value="https://node1.testnet.rchain-dev.tk:443">testnet validator 1</option>
              </select>
            </label>
            <br />
            <textarea id="term" cols="80" rows="8">
new deployId(`rho:rchain:deployId`),
log(`rho:io:stderr`)
in {
  log!("hello") |
  deployId!(1 + 1)
}
            </textarea>
            <div>
              <label for="phloLimit">phlo limit</label>
              <input id="phloLimit" value="10000"/>
            </div>
            <button id="deploy" type="button">Deploy</button>
        </fieldset>
    </form>
    <noscript>Please excuse lack of non-JavaScript support.</noscript>
  </div>
  <div class="card fluid" id="card-intro">
  <h2>Introductions: icons, names</h2>
  <p><em>WIP...
      see <a href="https://github.com/rchain-community/rv2020/issues/22"
             >secure avatar icons: identicons / jazzicons for zulip #22</a></em>
  </p>
  <form id="intro1">
    <fieldset>
      <label>Nickname <input id="nickname" /></label>
      <br />
      <img id="blockie1" />
    </fieldset>
  </form>
  </div>
  <div class="card fluid" id="card-contact">
    <h2>Contact</h2>
    <ul>
      <li>
        <a href="https://github.com/rchain-community">
          rchain-community</a>/<a href="https://github.com/rchain-community/rv2020">rv2020</a>
      </li>
    </ul>
    <address>
        <a href="https://www.madmode.com/">Dan Connolly</a>
    </address>
  </div>
</body>
</html>
